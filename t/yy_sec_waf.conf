#yy_sec_waf off;

#http_method GET POST;

#max_post_args_len 2048;

#denied_url "/redirect";

#####
#whitlist rule IDs:2000-2099
#####
#geo $ip_whitelist {
#  default 0;
#  127.0.0.1 1;
#}

#basic_rule $ip_whitelist eq:1 phase:1 id:2001 msg:"whitelist rule" gids:XSS lev:LOG|ALLOW;

#####
#xss attack IDs:1000-1099
#####
#deal tag
basic_rule ARGS regex:<(?:s(?:cript|tyle)|i(?:frame|n(?:put|s))|f(?:rame(?:set)?|orm)|a(?:pplet|ddress|rea)|b(?:ase|gsound|ody)|l(?:ayer|ink)|meta|object|textarea)[^>]*> phase:1 id:1001 msg:test gids:XSS lev:LOG|BLOCK;

#deal event and css style
basic_rule ARGS regex:[\s`'"](on(?:abort|blur|c(?:hange|lick)|d(?:blclick|ragdrop)|error|focus|key(?:down|press|up)|load|m(?:ouse(?:down|move|o(?:ut|ver)|up)|ove)|re(?:adystatechange|s(?:et|ize))|s(?:elect|ubmit)|unload)\s*?=|style\s*?=[^:]*?:\s*?(?:url|expression)) phase:1 id:1002 msg:test gids:XSS lev:LOG|BLOCK;

#deal javascript/vbscript/data:text/html
basic_rule ARGS "regex:[jvd&](#x[4567][46a];)?((b|&#x[46]2;)(s|&#x[57]3;)(c|&#x[46]3;)(r|&#x[57]2;)(i|&#x[46]9;)(p|&#x[57]0;)(t|&#x[57]4;)(:|&#x3a;)|(a|&#x[46]1;)((v|&#x[57]6;)(a|&#x[46]1;)(s|&#x[57]3;)(c|&#x[46]3;)(r|&#x[57]2;)(i|&#x[46]9;)(p|&#x[57]0;)(t|&#x[57]4;)(:|&#x3a;)|(t|&#x[57]4;)(a|&#x[46]1;)(:|&#x3a;)(t|&#x[57]4;)(e|&#x[46]5;)(x|&#x[57]8;)(t|&#x[57]4;)(/|&#x2f;)(h|&#x[46]8;)(t|&#x[57]4;)(m|&#x[46]d;)(l|&#x[46]c;)))" phase:1 id:1004 msg:test gids:xss lev:LOG|BLOCK;
#basic_rule ARGS regex:\b(javascript:|vbscript:|data:text/html) id:1004 msg:test gids:xss lev:LOG|BLOCK;

#deal %00. Since file upload detection had checked %00, the rule is wasting.
#basic_rule id:1007 regex:[<\s`'"].*?\x00[^=>]*[=>] msg:test pos:ARGS gids:XSS lev:LOG|BLOCK;

#deal injection of javascript, and function of  event.
basic_rule ARGS "regex:[\"']\s*?(?:(?:/\*.*?\*/)?\s*[;/%\+\-\*].+(?:\"|'|//|/\*|<!--)|;[^\(/<]*?(?:\(\s+['\"]|//|<!--|/\*))" phase:1 id:1008 msg:test gids:XSS lev:LOG|BLOCK;

#basic_rule ARGS regex:\ballowScriptAccess[\s]*?=[\s]*?always id:1009 msg:test gids:XSS lev:LOG|BLOCK;

##################
#command injection IDs:1100-1199
##################
basic_rule ARGS "regex:[;\|`&]\W*?(?:c(?:h(?:grp|mod|own|sh)|url|pp|c|d|at)|p(?:asswd|ython|erl|ing|s)|n(?:asm|et|map|c)|f(?:inger|tp)|t(?:elnet|raceroute|clsh8?|ftp)|g(?:cc|\+\+)|kill|mail|(?:xte)?rm|ls(?:of)?|echo|uname|wget|s(h|leep)|/bin/|id)\b" phase:1 id:1101 msg:test gids:command lev:LOG|BLOCK;

basic_rule PROCESS_BODY_ERROR eq:1 msg:"process body error" phase:2 id:1901 gids:UPLOAD  lev:LOG|BLOCK;

##################
# file upload IDs:1200-1299
##################
basic_rule MULTIPART_FILENAME regex:\.jsp|\.php|\.html|\.htm msg:"uncommon filename postfix" phase:2 id:1201 gids:UPLOAD  lev:LOG|BLOCK;
basic_rule MULTIPART_FILENAME regex:\.\./ msg:"special file charactors" phase:2 id:1201 gids:UPLOAD lev:LOG|BLOCK;


#################
#sql injection IDs:1300-1399
#################
basic_rule ARGS "regex:\b\d(x[0-9a-f]+|[0-9]*)\s+(and|or|&&|\|\|)(\s+((0x)?[0-9]+|['\"][^'\"&]{1,15}['\"]\s*[=><])|['\"][^'\"&]{1,15}['\"]\s*?[=><])" phase:1 id:1301 msg:test gids:SQL lev:LOG|BLOCK;

basic_rule ARGS regex:['"]\s+(and|or|&&|\|\|)\s*?(['"][^'"&]*['"]\s*[=><]\s*['"]|(0x[0-9a-f]+|[0-9]+)[^\#-&]*(\#|--)) phase:1 id:1302 msg:testgids:SQL lev:LOG|BLOCK;

basic_rule ARGS "regex:\b(ascii\s*\(|benchmark\s*\(|c(har\s*\(|oncat\s*\(|ase\s+when\b|urrent_user\b)|database\s*\(|group(_concat\s*\(|\s+by\b)|l(ength|oad_file)\s*\(|mysql\s*\.\s*(user|db|tables_priv|columns_priv)\b|order\s+by\b|version\s*\(|s(elect\b.{1,50}\bfrom\b|ystem_user\s*\(|ubstr(ing)?\s*\(|leep\s*\()|u(ser\s*\(|nion.{1,20}select\b)|i(f\s*\(|n(to\s+(outfile|dumpfile)\b|(formation_schema\s*\.))))" phase:1 id:1308 msg:test gids:SQL lev:LOG|BLOCK;

basic_rule ARGS "regex:[@/](@(version|datadir)|\*.{0,50}\*/)" phase:1 id:1309 msg:test gids:SQL lev:LOG|BLOCK;

basic_rule ARGS regex:\b(insert\s*into\b.*\bvalues|update\s+\w+\s+set|delete\s+from|CREATE\s+(DATABASE|TABLE)|DROP\s+(DATABASE|TABLE))\b phase:1 id:1310 msg:test gids:SQL lev:LOG|BLOCK;

